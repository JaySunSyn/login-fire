<!--
@license
Copyright (c) 2016 Convoo All Rights Reserved.
Use of this source code is governed by a MIT license that can be found in the
LICENSE file or at https://github.com/convoo/login-fire/blob/master/LICENSE.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="./login-fire-common-behavior.html">
<script>
(function() {
  'use strict';

  window.Convoo = window.Convoo || {};

  /**
   * Behaviour that allows an element using Firebase Auth to sign-in, sign-up
   * and sign-out with social provider authentication. If your element must be
   * able to use email address and password authentication only, you can
   * implement the `LoginFireFormBehavior`.
   *
   * @polymerBehavior Convoo.LoginFireSocialBehavior
   */
  Convoo.LoginFireSocialBehaviorImpl = {


      properties: {

        googleScopes: {
            type: String,
            value: ""
        },
        facebookScopes: {
            type: String,
            value: ""
        },
        githubScopes: {
            type: String,
            value: ""
        },
        _computedProvider: {
            type: Object,
            computed: "_computeProvider(provider, googleScopes, facebookScopes, githubScopes)"

        }
      },
    /**
     * Starts the sign-in process using a social provider authetication.
     */
    signIn: function() {
        if (!this.onlySignOut){
            if (this.provider === 'anonymous') {
                this.$.auth.signInAnonymously()
                .then(this._fireEvent.bind(this))
                .catch(this._fireError.bind(this));
            } else if (this.redirect) {
                this.$.auth.signInWithRedirect(this._computedProvider)
                .then(this._fireEvent.bind(this))
                .catch(this._fireError.bind(this));
            } else {
                this.$.auth.signInWithPopup(this._computedProvider)
                .then(this._fireEvent.bind(this))
                .catch(this._fireError.bind(this));
            }
        }
    },

    /**
     * Starts sign in or sign out a user. If there is currently a user logged
     * in the `signOut` method is called. If there is no user logged in, the
     * `signIn` method is called.
     */
    signInOrOut: function() {
      if (typeof this.user === 'undefined' || this.user == null) {
        this.signIn();
      } else {
        this.signOut();
      }
    },

    _computeProvider: function(provider, googleScopes, facebookScopes, githubScopes){
        provider = provider.toLowerCase();
        var compProvider;
        if (provider === "google"){
            compProvider =  new firebase.auth.GoogleAuthProvider();
            compProvider.addScope(googleScopes)
        } else if (provider === "facebook"){
            compProvider =  new firebase.auth.FacebookAuthProvider();
            compProvider.addScope(facebookScopes)
        } else if (provider === "twitter"){
            compProvider =  new firebase.auth.TwitterAuthProvider();
        } else if (provider === "github"){
            compProvider =  new firebase.auth.GithubAuthProvider();
            compProvider.addScope(githubScopes)
        }
        return compProvider;
    }
  };

  /**
   * @polymerBehavior
   */
  Convoo.LoginFireSocialBehavior = [
    Convoo.LoginFireCommonBehavior,
    Convoo.LoginFireSocialBehaviorImpl
  ]

})();
</script>
